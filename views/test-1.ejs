<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR & Barcode Scanner</title>
    <script src="https://unpkg.com/html5-qrcode" defer></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 20px;
        overflow: hidden;
      }
      #reader {
        width: 100%;
        max-width: 400px;
        margin: auto;
        position: relative;
      }

      /* üî• Khung qu√©t - Ban ƒë·∫ßu l√† m√†u x√°m */
      .scanner-border {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 350px;
        height: 150px;
        transform: translate(-50%, -50%);
        z-index: 99999;
        pointer-events: none;
        border: 4px solid gray;
        box-shadow: 0 0 15px gray;
        animation: border-animation 1s infinite alternate;
        display: block;
      }

      /* üî• Hi·ªáu ·ª©ng ph√°t s√°ng */
      @keyframes border-animation {
        from {
          border-color: gray;
        }
        to {
          border-color: lightgray;
        }
      }

      /* üî• Khi qu√©t th√†nh c√¥ng -> Chuy·ªÉn sang m√†u xanh */
      .scanner-success {
        border-color: green !important;
        box-shadow: 0 0 20px green !important;
      }

      /* üî• Khi qu√©t th·∫•t b·∫°i -> Chuy·ªÉn sang m√†u ƒë·ªè */
      .scanner-fail {
        border-color: red !important;
        box-shadow: 0 0 20px red !important;
      }

      #result {
        margin-top: 20px;
        font-weight: bold;
        font-size: 18px;
        color: green;
      }
    </style>
  </head>
  <body>
    <h1>Qu√©t QR & Barcode</h1>
    <div id="reader"></div>
    <div id="scanner-border" class="scanner-border"></div>
    <!-- üî• Khung qu√©t ƒë·ªông -->
    <p id="result">üìå K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</p>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const scannerBorder = document.getElementById('scanner-border')

        // üî• ·∫®n khung vi·ªÅn tr√™n iOS
        function isIOS() {
          return /iPhone|iPad|iPod/i.test(navigator.userAgent)
        }
        if (isIOS()) {
          scannerBorder.style.display = 'none'
        }

        function onScanSuccess(decodedText, decodedResult) {
          document.getElementById('result').innerText =
            'üìå K·∫øt qu·∫£: ' + decodedText
          scannerBorder.classList.remove('scanner-fail')
          scannerBorder.classList.add('scanner-success') // üî• Chuy·ªÉn sang m√†u xanh l√° khi qu√©t th√†nh c√¥ng
        }

        function onScanFailure(error) {
          console.warn(`L·ªói qu√©t: ${error}`)
          scannerBorder.classList.remove('scanner-success')
          scannerBorder.classList.add('scanner-fail') // üî• Chuy·ªÉn sang m√†u ƒë·ªè khi qu√©t th·∫•t b·∫°i
        }

        let html5QrcodeScanner = new Html5QrcodeScanner('reader', {
          fps: 10,
          qrbox: { width: 350, height: 150 }, // üî• Gi·ªØ khung ch·ªØ nh·∫≠t t·ªëi ∆∞u Barcode
          supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA]
        })

        html5QrcodeScanner.render(onScanSuccess, onScanFailure)
      })
    </script>
  </body>
</html>
